#! /usr/bin/bash

set -e # stop execution if anything fails

# build frontend files by sourcing build file and running functions
buildFilepath="$ABS_PATH/bin/frontend-nextjs/build"
source $buildFilepath

# Create function files
install
build
artifacts

abs_filepath="$ABS_PATH/terraform/frontend-nextjs"
FilePath=$(realpath --relative-base="$PWD" "$abs_filepath")

cd $FilePath

terraform validate
tflint
terraform apply -auto-approve

# sync after cloudfront is created/updated
buildFilepath="$ABS_PATH/bin/frontend-nextjs/build"
source $buildFilepath
sync_static
