(()=>{"use strict";var e={15:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function l(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,a)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.build=void 0;const r=i(o(17)),l=i(o(147)),a=o(593),c=o(593);t.build=()=>n(void 0,void 0,void 0,(function*(){yield n(void 0,void 0,void 0,(function*(){console.log("Running Next Build......"),yield(0,c.term)("npm run build")})),(()=>{console.log("Copying static files.....");const{srcPath:e,publicPath:t,standaloneOutputPath:o}=(0,a.filePath)(),n=r.default.join(o,"public");if(l.default.existsSync(t)){l.default.existsSync(n)||l.default.mkdirSync(n,{recursive:!0}),l.default.cpSync(t,n,{recursive:!0});const o=r.default.join(e,"favicon.ico");l.default.existsSync(o)&&l.default.copyFileSync(o,r.default.join(n,"favicon.ico"))}})(),(()=>{console.log("Creating run script.....");const{standaloneOutputPath:e}=(0,a.filePath)();l.default.writeFile(`${e}/run.sh`,"#!/bin/bash\n[ ! -d '/tmp/cache' ] && mkdir -p /tmp/cache\nexec node server.js",(e=>{if(e)throw e}))})(),console.log("Build complete!")}))},991:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function l(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.tfDelete=t.tfDeploy=void 0;const i=o(593),{tfPath:r,appPath:l}=(0,i.filePath)();t.tfDeploy=()=>n(void 0,void 0,void 0,(function*(){console.log("Running deploy command....."),yield(0,i.term)(`terraform -chdir=${r}/ apply -var="SOURCE_DIR=${l}/.next" --auto-approve`),console.log("\nDeploy complete!"),console.log("\nWait for CloudFront Deployment/Invalidation to complete....\n")})),t.tfDelete=()=>n(void 0,void 0,void 0,(function*(){const{tfPath:e}=(0,i.filePath)();console.log("Running deployment delete command....."),yield(0,i.term)(`terraform -chdir=${e}/ destroy -var="SOURCE_DIR=${l}/.next" --auto-approve`),console.log("Delete complete!")}))},607:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function l(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=o(15),r=o(991);(()=>{const e=process.argv.slice(2);"deploy"===e[0]?n(void 0,void 0,void 0,(function*(){yield(0,i.build)(),yield(0,r.tfDeploy)()})):"build"===e[0]?(0,i.build)():"delete"===e[0]?n(void 0,void 0,void 0,(function*(){yield(0,r.tfDelete)()})):console.log("Please provide a valid argument - deploy, delete or build")})()},593:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.term=t.filePath=void 0;const i=n(o(17)),r=n(o(147)),l=o(81);t.filePath=()=>{const e=i.default.join(process.cwd(),"."),t=r.default.existsSync(i.default.join(e,"src"))?"src/app":"app",o=i.default.join(e,t),n=i.default.join(process.cwd(),"../");return{srcPath:o,publicPath:i.default.join(e,"public"),appPath:e,standaloneOutputPath:i.default.join(e,".next","standalone"),staticOutputPath:i.default.join(e,".next","static"),tfPath:i.default.join(n,"tf")}},t.term=e=>new Promise(((t,o)=>{const n=(0,l.spawn)(e,{shell:!0});n.stdout.on("data",(e=>{process.stdout.write(`${e}`)})),n.stderr.on("data",(e=>{console.error(`${e}`)})),n.on("close",(e=>{t(e)})),n.on("error",(e=>{console.error(`Error: ${e}`),o(e)}))}))},81:e=>{e.exports=require("child_process")},147:e=>{e.exports=require("fs")},17:e=>{e.exports=require("path")}},t={};!function o(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,o),r.exports}(607)})();
//# sourceMappingURL=deploy.js.map